if (!document.querySelector('.grid-layout').classList.contains('edit')) {
  // Initialize Editing Grid

  // Hidden form template
  const newWidgetTemplateHTML = `
  <div id="new-widget-template" class="grid-item m-2 hidden">
    <div class="widget">
      <div class="widget-header d-flex justify-content-between">
        <h5>New widget</h5>
        <i class="far fa-times-circle btn-close scale-on-hover highlight-on-hover py-1 px-2 clickable"></i>
      </div>

      <div class="ctn-kpi justify-content-start w-100">
        <%=j render 'widgets/form_new', report: @report %>
      </div>
    </div>
  </div>
  `;

  // Grid elements
  const gridEditItemsHTML = "<%=j render 'reports/edit_grid_items', rows: 18, cols: 12 %>";

  const initEditGrid = () => {
    const grid = document.querySelector('.grid-layout')
    grid.insertAdjacentHTML("beforeEnd", gridEditItemsHTML)
    grid.insertAdjacentHTML("beforeEnd", newWidgetTemplateHTML)
    // Connect to stimulus dashbuilder-controller
    grid.dataset.controller = 'dashbuilder'
    grid.classList.add('edit')
  }

  initEditGrid()
} else {
  document.querySelector('.grid-layout').removeAttribute('data-controller')
}
